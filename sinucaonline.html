<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cardápio Digital</title>
    <style>
        body { font-family: Arial, sans-serif; }
        header { background-color: #FFA500; color: white; text-align: center; padding: 50px; position: relative; width: 82%; left: -4.1%; top: -10px; }
        
        .footer {
    width: 95%;
    background-color: #333; /* Cor de fundo */
    color: white; /* Cor do texto */
    text-align: center;
    padding: 20px;
    margin: 0; /* Remove margens que possam afetar a largura */
    position: relative;
    left: -2.7%;
}
        
        /* Estilos para os produtos dentro das categorias */
.product-container { /* Contêiner que envolve todos os produtos */
    display: flex;
    flex-direction: column;
    gap: 20px; /* Ajuste o valor do gap conforme necessário */
    margin-bottom: 10px;
}

.product {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s ease;
}

.product:hover {
    transform: translateY(-5px);
}

.product-title {
    font-size: 18px;
    font-weight: bold;
    color: #333;
}

.price {
    font-size: 16px;
    color: green;
}

.product p {
    font-size: 14px;
    color: #666;
    margin: 0;
}

.product button {
    background-color: #4a90e2;
    color: white;
    border: none;
    padding: 8px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    align-self: flex-start;
    transition: background-color 0.3s ease;
}

.product button:hover {
    background-color: #357ABD;
}
        
        .category-menu-container {
    display: flex;
    align-items: center;
    overflow: hidden;
    padding: 10px 0;
    position: relative;
    width: 100%;
}

.category-menu {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    scroll-behavior: smooth;
    width: calc(100% - 80px); /* Ajuste a largura para acomodar as setas */
    padding: 10px 0;
}

.category-menu button {
    background-color: #FFA500;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    white-space: nowrap;
    font-size: 16px;
    transition: background-color 0.3s ease;
}

.category-menu button:hover {
    background-color: #e59400;
}

.arrow-button {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #FFA500;
    padding: 15px;
}

.arrow-button:hover {
    color: #e59400;
}
        
        .hamburger-menu {
            position: absolute;
            top: 20px;
            right: 20px;
            cursor: pointer;
            font-size: 24px;
        }
        
     /* Estilos do menu lateral */
.menu-options {
    display: none;
    position: fixed;
    top: 0;
    right: -200px; /* Fora da tela */
    height: 100vh;
    background: #ffffff;
    border-radius: 0 0 10px 10px;
    width: 200px;
    padding-top: 20px;
    box-shadow: -2px 0 8px rgba(0, 0, 0, 0.2);
    z-index: 3000;
    transition: transform 0.3s ease;
    opacity: 0.95;
}

/* Classe para exibir o menu lateral */
.menu-options.show {
    display: block;
    transform: translateX(-200px); /* Move para dentro da tela */
}

/* Estilos do botão de seta para fechar */
.close-menu {
    position: absolute;
    top: 50%;
    left: -20px; /* Posiciona a seta fora do menu */
    background: #FFA500;
    color: white;
    border: none;
    border-radius: 0 5px 5px 0;
    padding: 5px 10px;
    cursor: pointer;
    font-size: 18px;
}

/* Estilos dos links no menu */
.menu-options a {
    display: block;
    padding: 15px 20px;
    text-decoration: none;
    color: #333;
    font-size: 14px;
    transition: background-color 0.2s ease, color 0.2s ease;
}

.menu-options a:hover {
    background-color: #f5f5f5;
    color: #FFA500;
}

        /* Modal flutuante para edição */
        #edit-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            width: 300px;
        }

        #edit-modal h2 {
            margin-bottom: 15px;
            text-align: center;
        }

        #edit-modal input, #edit-modal select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        #edit-modal button {
            width: 100%;
            padding: 10px;
            background-color: #4a90e2;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #edit-modal button:hover {
            background-color: #357ABD;
        }
        
    /* Estilo para cada item do carrinho */
    .cart-item {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 10px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        background-color: #f9f9f9;
    }

    .cart-item-info {
        flex-grow: 1;
        font-size: 14px;
        color: #333;
    }

    .cart-item-info .product-name {
        font-weight: bold;
        font-size: 16px;
        color: #333;
    }

    .cart-item-info .product-price {
        font-size: 14px;
        color: #e59400;
        margin-top: 5px;
    }

    /* Botão de remover item */
    .remove-button {
        color: red;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 18px;
        padding: 5px;
    }

    /* Estilo do modal do carrinho */
    #cart-modal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        width: 90%;
        max-width: 450px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        z-index: 2000;
        max-height: 80vh;
        overflow-y: auto;
        border: 2px solid #333;
    }

    .close-button {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 18px;
        color: red;
        cursor: pointer;
    }

    .main-button {
        width: 100%;
        padding: 10px;
        background-color: #4a90e2;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 15px;
    }

#cart-modal input, #cart-modal select {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
}

#fixed-cart-button {
    position: fixed;
    bottom: 20px; /* Define a posição vertical */
    right: 35%; /* Define a posição horizontal */
    padding: 10px 20px;
    background-color: #FFA500;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
    z-index: 1000; /* Mantém o botão acima de outros elementos */
}

    /* Estilo para o botão de opções (...) */
    .options-button {
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: #333;
        align-self: flex-end;
        padding: 5px;
        margin-top: -10px;
    }

    /* Modal de opções (Editar/Remover) */
    #options-modal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        width: 200px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        z-index: 3000;
    }

    #options-modal button {
        width: 100%;
        padding: 10px;
        background-color: #4a90e2;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-bottom: 10px;
    }

    #options-modal button:hover {
        background-color: #357ABD;
    }

   /* Estilo do botão de fechar no modal de opções */
.close-options-modal {
    background-color: #FF6347; /* Cor de fundo vermelha */
    color: white;
    border: none;
    padding: 10px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s ease;
}

.close-options-modal:hover {
    background-color: #d9534f; /* Tom de vermelho mais escuro ao passar o mouse */
}

/* Estilo geral do modal */
.modal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #ffffff;
    padding: 20px;
    width: 90%;
    max-width: 400px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    z-index: 3000;
    text-align: center;
}

/* Estilo do título */
.modal h2 {
    margin-bottom: 20px;
    font-size: 24px;
    color: #333;
}

/* Lista de categorias */
#categoria-list {
    list-style: none;
    padding: 0;
    margin: 0 0 20px;
}

#categoria-list li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    margin-bottom: 10px;
    background-color: #f9f9f9;
}

/* Campo de entrada para nova categoria */
.input-text {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 16px;
}

/* Estilo dos botões */
.button-add,
.button-close,
#categoria-list li button {
    padding: 8px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.3s ease;
}

/* Botão de adicionar categoria */
.button-add {
    background-color: #4CAF50;
    color: white;
    margin-top: 10px;
}

.button-add:hover {
    background-color: #45a049;
}

/* Botão de fechar modal */
.button-close {
    background-color: #FF6347; /* Cor de fundo vermelha */
    color: white;
    margin-top: 10px;
    padding: 10px; /* Adiciona um espaçamento */
    width: 100%; /* Largura total para ocupar o botão inteiro */
    font-size: 16px;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    transition: background-color 0.3s ease;
}

.button-close:hover {
    background-color: #d9534f; /* Tom de vermelho mais escuro ao passar o mouse */
}

/* Botão de remover dentro da lista de categorias */
#categoria-list li button {
    background-color: #FF6347;
    color: white;
    padding: 5px 10px;
}

#categoria-list li button:hover {
    background-color: #d9534f;
}
    </style>
</head>
<body>

<!-- Botão de Menu Hambúrguer no Header -->
<header>
    <h1>Cardápio Digital</h1>
    <div class="hamburger-menu" onclick="toggleMenu()">&#9776;</div>
</header>

<!-- Menu Lateral com botão de seta para fechar -->
<div class="menu-options" id="menu-options">
    <button class="close-menu" onclick="toggleMenu()">&#10095;</button> <!-- Seta para fechar o menu -->
    <a href="https://goscripts.online/gameon" onclick="toggleMenu()">Login</a>
    <a href="#" onclick="toggleMenu()">Pedidos Enviados</a>
    <a href="#" id="edit-link" onclick="openEditModal(); toggleMenu()" style="display: none;">Adicionar produto</a> <!-- Link de edição para o dono -->
    <div id="gerenciar-categorias" style="display: none;">
        <a href="#" onclick="abrirCategoriaModal(); toggleMenu()">Gerenciar Categorias</a>
    </div>
    <div id="configuracoes-tema" style="display: none;">
    <a href="#" onclick="abrirTemaModal(); toggleMenu()">Configurações de Tema</a>
</div>
</div>

<div id="tema-modal" class="modal">
    <h2>Configurações de Tema</h2>

    <!-- Campo para alterar o título -->
    <label for="titulo-pagina">Título da Página:</label>
    <input type="text" id="titulo-pagina" placeholder="Digite o novo título">

    <!-- Campo para alterar as cores -->
    <label for="cor-fundo-site">Cor de Fundo do Site:</label>
    <input type="color" id="cor-fundo-site">

    <label for="cor-fundo-header">Cor de Fundo do Header:</label>
    <input type="color" id="cor-fundo-header">

    <label for="cor-seta-categoria">Cor da Seta e Botões de Categoria:</label>
    <input type="color" id="cor-seta-categoria">

    <!-- Botão para salvar as configurações -->
    <button onclick="salvarTema()" class="button-add">Salvar Configurações</button>
    <button onclick="fecharTemaModal()" class="button-close">Fechar</button>
</div>

<!-- Modal de Gerenciamento de Categorias -->
<div id="categoria-modal" class="modal">
    <h2>Gerenciar Categorias</h2>

    <!-- Listar Categorias Existentes -->
    <ul id="categoria-list">
        <!-- Categorias serão listadas dinamicamente aqui -->
    </ul>

    <!-- Formulário para adicionar uma nova categoria -->
    <input type="text" id="nova-categoria" placeholder="Nova categoria" class="input-text">
    <button onclick="adicionarCategoria()" class="button-add">Adicionar Categoria</button>

    <!-- Botão para fechar o modal -->
    <button onclick="fecharCategoriaModal()" class="button-close">Fechar</button>
</div>

<div class="category-menu-container">
    <button class="arrow-button" onclick="scrollCategoryMenu(-1)">&#10094;</button>
    <div class="category-menu" id="category-menu">
        <!-- Botões de categoria serão adicionados aqui via JavaScript -->
    </div>
    <button class="arrow-button" onclick="scrollCategoryMenu(1)">&#10095;</button>
</div>

<div id="category-container">
    <h2 id="category-title">Selecione uma categoria para ver!</h2>
    <div id="category-products"></div>
</div>

<button onclick="abrirCarrinho()" id="fixed-cart-button">Ver Carrinho</button>

<div id="cart-modal">
    <button class="close-button" onclick="fecharCarrinho()">X</button>
    <h2>Seu Carrinho</h2>
    <div id="cart-modal-items"></div>
    <p>Total: R$ <span id="cart-modal-total">0.00</span></p>

    <h3>Informações para entrega</h3>
    <label for="name">Nome:</label>
    <input type="text" id="name" placeholder="Nome completo">

    <label for="cep">CEP:</label>
    <input type="text" id="cep" placeholder="CEP" onblur="preencherEndereco()">

    <label for="rua">Rua:</label>
    <input type="text" id="rua" placeholder="Rua">

    <label for="numero">Número:</label>
    <input type="text" id="numero" placeholder="Número da casa">

    <label for="bairro">Bairro:</label>
    <input type="text" id="bairro" placeholder="Bairro">

    <label for="cidade">Cidade:</label>
    <input type="text" id="cidade" placeholder="Cidade">

    <label for="ponto-referencia">Ponto de Referência:</label>
    <input type="text" id="ponto-referencia" placeholder="Ponto de Referência">

    <label for="pagamento">Forma de Pagamento:</label>
<select id="pagamento" onchange="exibirCampoTroco()">
    <option value="" disabled selected>Selecione</option>
    <option value="dinheiro">Dinheiro</option>
    <option value="cartao">Cartão</option>
    <option value="pix">Pix</option>
</select>

<!-- Campo para informar o troco -->
<div id="troco-container" style="display: none;">
    <label for="troco">Troco para:</label>
    <input type="number" id="troco" placeholder="Informe o valor do troco">
</div>

    <button class="main-button" onclick="finalizarPedido()">Finalizar Pedido</button>
</div>

<!-- Modal de opções para editar e remover produto -->
<div id="options-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); z-index: 2000; width: 200px;">
    <button class="close-options-modal" onclick="fecharOptionsModal()" style="background-color: #FF6347; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-size: 16px;">Fechar janela</button>
    <button onclick="editarProduto(selectedProductId, selectedCategory)" style="width: 100%; margin: 10px 0;">Editar Produto</button>
    <button onclick="removerProduto(selectedProductId, selectedCategory)" style="width: 100%; margin: 10px 0;">Remover Produto</button>
</div>

<!-- Modal para adicionar ou editar produtos -->
<div id="edit-modal">
    <h2 id="modal-title">Adicionar Produto</h2> <!-- O título será atualizado dinamicamente -->
    <label for="product-name">Nome:</label>
    <input type="text" id="product-name" placeholder="Nome do Produto">
    
    <label for="product-price">Preço:</label>
    <input type="number" id="product-price" placeholder="Preço do Produto">
    
    <label for="product-category">Categoria:</label>
<select id="product-category">
    <!-- Opções de categoria serão preenchidas dinamicamente -->
</select>

    <label for="product-description">Descrição:</label>
    <input type="text" id="product-description" placeholder="Descrição do Produto">
    
    <!-- O botão salvar chama a função correta com base no contexto (adicionar ou editar) -->
    <button id="save-product-button" onclick="salvarOuAdicionarProduto()">Salvar Produto</button>
</div>

<footer class="footer">
    © 2024 GoScripts
</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
    // UID do dono do estabelecimento
    const OWNER_UID = '46a65542-c54b-420e-8946-e822a6f21bb9';

    // Inicialize o cliente Supabase
    const SUPABASE_URL = 'https://jkcdogakjwcpezuaqgki.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImprY2RvZ2FrandjcGV6dWFxZ2tpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzA2ODc2OTksImV4cCI6MjA0NjI2MzY5OX0.MxzcUE3s8Cyty6Y8IP4O-1Tzx57RVnZi1VDNSixswQE';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const products = { pizzas: [], esfirras: [], bebidas: [], refrigerantes: [] };

    async function carregarCardapio() {
    const { data, error } = await supabaseClient.from('cardapio').select('*');
    if (error) { 
        console.error("Erro ao carregar o cardápio:", error); 
        return; 
    }

    // Limpa o objeto de produtos
    Object.keys(products).forEach(category => products[category] = []);

    // Popula produtos para as categorias
    data.forEach(item => {
        if (!products[item.category]) {
            products[item.category] = []; // Cria a categoria dinamicamente se não existir
        }
        products[item.category].push(item);
    });
}

    function openCategory(category) {
    const categoryTitle = document.getElementById('category-title');
    const categoryProducts = document.getElementById('category-products');
    categoryTitle.innerText = category.charAt(0).toUpperCase() + category.slice(1);
    categoryProducts.innerHTML = '';

    products[category].forEach(product => {
        const productElement = document.createElement('div');
        productElement.classList.add('product');
        productElement.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span class="product-title">${product.nome}</span>
                ${isOwner ? `<button class="options-button" onclick="abrirOptionsModal(${product.id}, '${category}')">...</button>` : ''}
            </div>
            <span class="price">R$ ${product.preco.toFixed(2).replace('.', ',')}</span>
            <p>${product.descricao}</p>
            <button onclick="adicionarAoCarrinho(${product.id}, '${category}')">Adicionar ao Carrinho</button>
        `;
        categoryProducts.appendChild(productElement);
    });

    document.getElementById('category-container').style.display = 'block';
}

let selectedProductId;
let selectedCategory;

function abrirOptionsModal(productId, category) {
    selectedProductId = productId;
    selectedCategory = category;
    document.getElementById('options-modal').style.display = 'block';
}

function fecharOptionsModal() {
    document.getElementById('options-modal').style.display = 'none';
}

function abrirEditModal() {
    if (selectedProductId && selectedCategory) {
        editarProduto(selectedProductId, selectedCategory); // Abre o modal de edição com o produto selecionado
        fecharOptionsModal();
    }
}

function confirmarRemocao() {
    if (selectedProductId && selectedCategory) {
        removerProduto(selectedProductId, selectedCategory); // Remove o produto selecionado
        fecharOptionsModal();
    }
}

let carrinho = [];

function adicionarAoCarrinho(id, category) {
    const product = products[category].find(item => item.id === id);
    if (product) {
        carrinho.push(product);
        atualizarCarrinhoModal();
        alert(`${product.nome} foi adicionado ao carrinho.`);
    } else {
        console.error("Produto não encontrado para adicionar ao carrinho.");
    }
}

function atualizarCarrinhoModal() {
    const cartModalItems = document.getElementById('cart-modal-items');
    const cartModalTotal = document.getElementById('cart-modal-total');

    cartModalItems.innerHTML = ''; // Limpa os itens do carrinho
    let total = 0;

    carrinho.forEach((product, index) => {
        total += product.preco;

        // Criação do item do carrinho como um contêiner flexível
        const itemElement = document.createElement('div');
        itemElement.classList.add('cart-item'); // Aplica a classe do estilo

        // Informações do produto no carrinho
        const productInfo = document.createElement('div');
        productInfo.classList.add('cart-item-info');
        productInfo.innerHTML = `<span class="product-name">${product.nome}</span>
                                 <span class="product-price">R$ ${product.preco.toFixed(2).replace('.', ',')}</span>`;

        // Botão "X" para remover o item
        const removeButton = document.createElement('button');
        removeButton.innerText = 'X';
        removeButton.classList.add('remove-button');
        removeButton.onclick = () => removerDoCarrinho(index);

        // Adiciona os elementos ao item do carrinho
        itemElement.appendChild(productInfo);
        itemElement.appendChild(removeButton);

        // Adiciona o item ao modal do carrinho
        cartModalItems.appendChild(itemElement);
    });

    // Atualiza o total
    cartModalTotal.innerText = total.toFixed(2).replace('.', ',');
}

function abrirCarrinho() {
    document.getElementById('cart-modal').style.display = 'block';
}

function fecharCarrinho() {
    document.getElementById('cart-modal').style.display = 'none';
}

// Função para preencher o endereço com base no CEP
async function preencherEndereco() {
    const cep = document.getElementById('cep').value;
    if (cep.length === 8) {
        try {
            const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
            const data = await response.json();
            if (!data.erro) {
                document.getElementById('rua').value = data.logradouro;
                document.getElementById('bairro').value = data.bairro;
                document.getElementById('cidade').value = data.localidade;
            }
        } catch (error) {
            console.error("Erro ao buscar o CEP:", error);
        }
    }
}

function removerDoCarrinho(index) {
    carrinho.splice(index, 1); // Remove o item do carrinho pelo índice
    atualizarCarrinhoModal(); // Atualiza o modal do carrinho
}
    
    let editingProductId = null;

function editarProduto(id, category) {
    const product = products[category].find(item => item.id === id);
    if (product) {
        document.getElementById('product-name').value = product.nome;
        document.getElementById('product-price').value = product.preco;
        document.getElementById('product-category').value = product.category;
        document.getElementById('product-description').value = product.descricao;
        
        editingProductId = id; // Armazena o ID do produto em edição
        document.getElementById('modal-title').innerText = "Editar Produto";
        openEditModal();
    }
}

async function salvarProduto() {
    const nome = document.getElementById('product-name').value;
    const preco = parseFloat(document.getElementById('product-price').value);
    const categoria = document.getElementById('product-category').value;
    const descricao = document.getElementById('product-description').value;

    if (!nome || isNaN(preco) || !categoria || !descricao) {
        alert("Por favor, preencha todos os campos corretamente.");
        return;
    }

    const { error } = await supabaseClient.from('cardapio').update({
        nome, preco, category: categoria, descricao
    }).eq('id', editingProductId);

    if (error) {
        console.error("Erro ao salvar produto:", error);
        alert("Erro ao salvar produto.");
    } else {
        alert("Produto atualizado com sucesso!");
        closeEditModal();

        // Atualiza o produto no array local
        const productIndex = products[categoria].findIndex(item => item.id === editingProductId);
        if (productIndex !== -1) {
            products[categoria][productIndex] = { id: editingProductId, nome, preco, category: categoria, descricao };
            openCategory(categoria); // Atualiza a categoria ativa para exibir o produto atualizado
        }

        editingProductId = null; // Reseta o ID de edição
    }
}

async function removerProduto(id, categoria) {
    const { error } = await supabaseClient.from('cardapio').delete().eq('id', id);

    if (error) {
        console.error("Erro ao remover produto:", error);
        alert("Erro ao remover produto.");
    } else {
        alert("Produto removido com sucesso!");

        // Remove o produto do array local da categoria
        products[categoria] = products[categoria].filter(product => product.id !== id);

        // Atualiza a exibição da categoria ativa para refletir a remoção em tempo real
        openCategory(categoria);
    }
}

function salvarOuAdicionarProduto() {
    if (editingProductId) {
        salvarProduto(); // Se estamos editando um produto existente
    } else {
        adicionarProduto(); // Se estamos adicionando um novo produto
    }
}

    async function adicionarProduto() {
    const nome = document.getElementById('product-name').value;
    const preco = parseFloat(document.getElementById('product-price').value);
    const categoria = document.getElementById('product-category').value;
    const descricao = document.getElementById('product-description').value;

    if (!nome || isNaN(preco) || !categoria || !descricao) {
        alert("Por favor, preencha todos os campos corretamente.");
        return;
    }

    const { data, error } = await supabaseClient.from('cardapio').insert([
        { nome, preco, category: categoria, descricao }
    ]);

    if (error) {
        console.error("Erro ao adicionar produto:", error);
        alert("Erro ao adicionar produto.");
    } else {
        alert("Produto adicionado com sucesso!");
        closeEditModal();

        // Atualiza o cardápio e recarrega a categoria ativa para exibir o novo produto
        await carregarCardapio();
        openCategory(categoria);
    }
}

    let isOwner = false; // Variável global para armazenar se o usuário é o dono

// Função para verificar a permissão do usuário
async function verificarPermissao() {
    const { data: user, error } = await supabaseClient.auth.getUser();

    if (error) {
        console.error("Erro ao obter usuário:", error);
        return;
    }

    // Verifica se o UID do usuário corresponde ao UID do dono
    if (user && user.user && user.user.id === OWNER_UID) {
        document.getElementById('edit-link').style.display = 'block'; // Mostra a opção "Adicionar Produto" no menu
        document.getElementById('gerenciar-categorias').style.display = 'block'; // Mostra a opção "Gerenciar Categorias"
        isOwner = true; // Define isOwner como true para o dono
    } else {
        isOwner = false; // Define isOwner como false para outros usuários
    }
}

document.addEventListener("DOMContentLoaded", async () => {
    await verificarPermissao(); // Verifica a permissão do usuário primeiro
    await carregarCardapio(); // Carrega o cardápio apenas após verificar a permissão
});

    // Função para alternar o menu de opções
    // Função para alternar a visibilidade do menu
function toggleMenu() {
    const menu = document.getElementById('menu-options');
    menu.classList.toggle('show');
}

    // Função para abrir o modal de edição
    function openEditModal() {
        document.getElementById('edit-modal').style.display = 'block';
    }

    // Função para fechar o modal de edição
    function closeEditModal() {
        document.getElementById('edit-modal').style.display = 'none';
    }
    
    function finalizarPedido() {
    const nome = document.getElementById('name').value;
    const cep = document.getElementById('cep').value;
    const rua = document.getElementById('rua').value;
    const numero = document.getElementById('numero').value;
    const bairro = document.getElementById('bairro').value;
    const cidade = document.getElementById('cidade').value;
    const pontoReferencia = document.getElementById('ponto-referencia').value;
    const pagamento = document.getElementById('pagamento').value;
    const troco = document.getElementById('troco').value;

    // Texto da mensagem para enviar via WhatsApp
    let mensagem = `*Pedido de Cardápio Digital*%0A`;
    mensagem += `*Nome:* ${nome}%0A`;
    mensagem += `*Endereço:* ${rua}, ${numero}, ${bairro}, ${cidade} - CEP: ${cep}%0A`;
    mensagem += `*Ponto de Referência:* ${pontoReferencia}%0A`;
    mensagem += `*Forma de Pagamento:* ${pagamento}%0A`;
    
    // Adiciona o troco à mensagem se a forma de pagamento for "Dinheiro"
    if (pagamento === 'dinheiro' && troco) {
        mensagem += `*Troco para:* R$ ${parseFloat(troco).toFixed(2).replace('.', ',')}%0A`;
    }

    mensagem += `%0A*Itens do Carrinho:*%0A`;
    carrinho.forEach(item => {
        mensagem += `- ${item.nome} - R$ ${item.preco.toFixed(2).replace('.', ',')}%0A`;
    });

    const total = carrinho.reduce((acc, item) => acc + item.preco, 0);
    mensagem += `%0A*Total:* R$ ${total.toFixed(2).replace('.', ',')}`;

    // Abrir WhatsApp com o link de mensagem
    const whatsappLink = `https://wa.me/5519998133764?text=${mensagem}`;
    window.open(whatsappLink, '_blank');

    // Fechar o carrinho após enviar o pedido
    fecharCarrinho();
}

function scrollCategoryMenu(direction) {
    const categoryMenu = document.querySelector('.category-menu');
    const scrollAmount = 200; // Ajuste a distância de rolagem

    categoryMenu.scrollBy({
        left: direction * scrollAmount,
        behavior: 'smooth'
    });
}

let startX;

document.querySelector('.category-menu').addEventListener('touchstart', (e) => {
    startX = e.touches[0].clientX;
});

document.querySelector('.category-menu').addEventListener('touchmove', (e) => {
    const touch = e.touches[0];
    const change = startX - touch.clientX;

    if (Math.abs(change) > 50) { // Define um limite para detectar o swipe
        scrollCategoryMenu(change > 0 ? 1 : -1);
        startX = touch.clientX; // Atualiza para o próximo movimento
    }
});

document.addEventListener("DOMContentLoaded", () => {
    const cartModalItems = document.getElementById('cart-modal-items');
    const cartModalTotal = document.getElementById('cart-modal-total');

    // Verifique se os elementos existem antes de tentar manipular o conteúdo
    if (cartModalItems && cartModalTotal) {
        atualizarCarrinhoModal();
    } else {
        console.error("Elementos do modal de carrinho não encontrados no DOM.");
    }
});

function abrirCarrinho() {
    document.getElementById('cart-modal').style.display = 'block';
}

function fecharCarrinho() {
    document.getElementById('cart-modal').style.display = 'none';
}

function exibirCampoTroco() {
    const pagamento = document.getElementById('pagamento').value;
    const trocoContainer = document.getElementById('troco-container');
    trocoContainer.style.display = (pagamento === 'dinheiro') ? 'block' : 'none';
}

let categorias = ["pizzas", "esfirras", "bebidas", "refrigerantes"]; // Exemplo de categorias existentes

// Função para abrir o modal de categorias
function abrirCategoriaModal() {
    if (isOwner) {
        listarCategorias();
        document.getElementById('categoria-modal').style.display = 'block';
    } else {
        alert("Acesso não autorizado.");
    }
}

// Função para fechar o modal de categorias
function fecharCategoriaModal() {
    document.getElementById('categoria-modal').style.display = 'none';
}

// Função para listar categorias no modal
async function listarCategorias() {
    const categoriaList = document.getElementById('categoria-list');
    const categoryMenu = document.getElementById('category-menu');

    // Limpa a lista de categorias no modal e no menu principal
    categoriaList.innerHTML = '';
    categoryMenu.innerHTML = '';

    const { data: categorias, error } = await supabaseClient.from('categoriadecardapio').select('*');
    if (error) {
        console.error("Erro ao carregar categorias:", error);
        return;
    }

    categorias.forEach((categoria) => {
        // Atualiza a lista de categorias no modal
        const listItem = document.createElement('li');
        listItem.innerHTML = `
            <input type="text" value="${categoria.nome}" onchange="renomearCategoria(${categoria.id}, this.value)">
            <button onclick="removerCategoria(${categoria.id})">Remover</button>
        `;
        categoriaList.appendChild(listItem);

        // Atualiza o menu de categorias principal
        const categoryButton = document.createElement('button');
        categoryButton.innerText = categoria.nome.charAt(0).toUpperCase() + categoria.nome.slice(1);
        categoryButton.onclick = () => openCategory(categoria.nome);
        categoryMenu.appendChild(categoryButton);
    });
}

// Função para adicionar uma nova categoria
async function adicionarCategoria() {
    if (!isOwner) return alert("Acesso não autorizado.");

    const novaCategoria = document.getElementById('nova-categoria').value.trim();
    if (novaCategoria) {
        const { data, error } = await supabaseClient.from('categoriadecardapio').insert([{ nome: novaCategoria.toLowerCase() }]);

        if (error) {
            console.error("Erro ao adicionar categoria:", error);
            alert("Erro ao adicionar categoria.");
        } else {
            alert("Categoria adicionada com sucesso!");
            document.getElementById('nova-categoria').value = ''; // Limpa o campo
            listarCategorias(); // Atualiza o menu e o modal de categorias
            await carregarCategoriasParaSelect(); // Atualiza o select de categorias no modal de produto
        }
    } else {
        alert("Nome de categoria inválido.");
    }
}

// Função para renomear uma categoria
async function renomearCategoria(id, novoNome) {
    if (!isOwner) return alert("Acesso não autorizado.");

    if (novoNome) {
        const { error } = await supabaseClient.from('categoriadecardapio').update({ nome: novoNome.toLowerCase() }).eq('id', id);

        if (error) {
            console.error("Erro ao renomear categoria:", error);
            alert("Erro ao renomear categoria.");
        } else {
            alert("Categoria renomeada com sucesso!");
            listarCategorias();
            await carregarCategoriasParaSelect(); // Atualiza o select de categorias no modal de produto
        }
    } else {
        alert("Nome inválido.");
    }
}

// Função para remover uma categoria
async function removerCategoria(id) {
    if (!isOwner) return alert("Acesso não autorizado.");

    const { error } = await supabaseClient.from('categoriadecardapio').delete().eq('id', id);

    if (error) {
        console.error("Erro ao remover categoria:", error);
        alert("Erro ao remover categoria.");
    } else {
        alert("Categoria removida com sucesso!");
        listarCategorias();
        await carregarCategoriasParaSelect(); // Atualiza o select de categorias no modal de produto
    }
}

// Função para carregar categorias da nova tabela
async function carregarCategorias() {
    const { data, error } = await supabaseClient.from('categoriadecardapio').select('*');
    
    if (error) {
        console.error("Erro ao carregar categorias:", error);
        return;
    }

    // Limpa o menu de categorias antes de atualizar
    const categoryMenu = document.getElementById('category-menu');
    categoryMenu.innerHTML = '';

    // Adiciona cada categoria ao menu
    data.forEach(categoria => {
        const categoryButton = document.createElement('button');
        categoryButton.innerText = categoria.nome.charAt(0).toUpperCase() + categoria.nome.slice(1);
        categoryButton.onclick = () => openCategory(categoria.nome);
        categoryMenu.appendChild(categoryButton);
    });
}

// Chame a função de carregar categorias quando a página for carregada
document.addEventListener("DOMContentLoaded", async () => {
    await carregarCategorias();
});

async function carregarCategoriasParaSelect() {
    const productCategorySelect = document.getElementById('product-category');
    productCategorySelect.innerHTML = ''; // Limpa as opções atuais

    const { data: categorias, error } = await supabaseClient.from('categoriadecardapio').select('*');
    if (error) {
        console.error("Erro ao carregar categorias para o select:", error);
        return;
    }

    // Adiciona cada categoria como uma opção no select
    categorias.forEach(categoria => {
        const option = document.createElement('option');
        option.value = categoria.nome;
        option.text = categoria.nome.charAt(0).toUpperCase() + categoria.nome.slice(1);
        productCategorySelect.appendChild(option);
    });
}

document.addEventListener("DOMContentLoaded", async () => {
    await verificarPermissao();
    await carregarCardapio();
    await carregarCategorias(); // Carrega categorias no menu
    await carregarCategoriasParaSelect(); // Carrega categorias no select do modal de produto
});

async function carregarCategoriasParaSelect() {
    const productCategorySelect = document.getElementById('product-category');
    productCategorySelect.innerHTML = ''; // Limpa as opções atuais

    const { data: categorias, error } = await supabaseClient.from('categoriadecardapio').select('*');
    if (error) {
        console.error("Erro ao carregar categorias para o select:", error);
        return;
    }

    // Adiciona cada categoria como uma opção no select
    categorias.forEach(categoria => {
        const option = document.createElement('option');
        option.value = categoria.nome;
        option.text = categoria.nome.charAt(0).toUpperCase() + categoria.nome.slice(1);
        productCategorySelect.appendChild(option);
    });
}

function abrirTemaModal() {
    if (isOwner) {
        document.getElementById('tema-modal').style.display = 'block';
    } else {
        alert("Acesso não autorizado.");
    }
}

function fecharTemaModal() {
    document.getElementById('tema-modal').style.display = 'none';
}

async function salvarTema() {
    const titulo = document.getElementById('titulo-pagina').value;
    const corFundoSite = document.getElementById('cor-fundo-site').value;
    const corFundoHeader = document.getElementById('cor-fundo-header').value;
    const corSetaCategoria = document.getElementById('cor-seta-categoria').value;

    // Atualizar o título da página
    document.querySelector('header h1').innerText = titulo;

    // Aplicar as cores selecionadas
    document.body.style.backgroundColor = corFundoSite;
    document.querySelector('header').style.backgroundColor = corFundoHeader;
    document.querySelectorAll('.arrow-button, .category-menu button').forEach(el => el.style.backgroundColor = corSetaCategoria);

    // Salvar as configurações no banco de dados (opcional)
    if (isOwner) {
        const { error } = await supabaseClient.from('cores').upsert({
            id: OWNER_UID,
            titulo: titulo,
            corFundoSite: corFundoSite,
            corFundoHeader: corFundoHeader,
            corSetaCategoria: corSetaCategoria
        });

        if (error) {
            console.error("Erro ao salvar configurações:", error);
            alert("Erro ao salvar configurações.");
        } else {
            alert("Configurações salvas com sucesso!");
            fecharTemaModal();
        }
    }
}

async function carregarTema() {
    const { data, error } = await supabaseClient.from('cores').select('*').eq('id', OWNER_UID).single();

    if (data) {
        // Aplica as configurações salvas
        document.querySelector('header h1').innerText = data.titulo;
        document.body.style.backgroundColor = data.corFundoSite;
        document.querySelector('header').style.backgroundColor = data.corFundoHeader;
        document.querySelectorAll('.arrow-button, .category-menu button').forEach(el => el.style.backgroundColor = data.corSetaCategoria);
    }
}

document.addEventListener("DOMContentLoaded", async () => {
    await verificarPermissao();
    await carregarCardapio();
    await carregarCategorias();
    await carregarCategoriasParaSelect();
    await carregarTema(); // Carregar configurações de tema
});
</script>

</body>
</html>